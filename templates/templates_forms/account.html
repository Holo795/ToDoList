<link rel="stylesheet" type="text/css" href="../../static/styles/templates_forms_styles/account.css" />
<div id="account_form_parent">
    <div id="account_form">
        <img src="../../static/icons/close_blanc.png" id="close_task" alt="Fermer" title="Fermer" onclick="clear_error()">

        <h2>Informations du compte</h2>
        <form method="POST" autocomplete="off">
            <div class="input_box">
                <input type="text" name="username" id="id" value="{{ user.get_username() }}" maxlength="20" required>
                <label>Identifiant</label>
                <span></span>
            </div>

            <div class="input_box">
                <input type="password" name="password" id="mdp" value="">
                <label>Mot de passe</label>
                <span></span>
            </div>

			<div id="categories">
				<h3>Catégories :</h3>
				<ul>
                    {% for type in user.get_types() %}
                        <li>{{ type[1] }}</li>
                    {% endfor %}
				</ul>
            </div>

            <input type="hidden" name="new_type_length" value="0">

			<input type="button" value="Nouvelle catégorie" onclick="nouvelle_categorie()"/>

            <p id="error"></p>

            <div id="boutons">
                <input type="submit" value="Enregistrer" formaction="{{ url_for('update_user') }}" onclick="checkpass()">
            </div>
            <script>

                function clear_error() {
                    document.getElementById("error").innerHTML = "";
                }

                function checkpass(){
                    if(document.getElementById("mdp").value.length < 3 && document.getElementById("mdp").value.length > 0){
                        document.getElementById("error").innerHTML = "Le mot de passe doit contenir au moins 3 caractères";
                        event.preventDefault();
                    }
                }

				function nouvelle_categorie() {

                    let input = document.getElementsByName("new_type_length")[0];
                    let list_type = document.getElementById("categories").querySelector("ul")
                    let li_elements = list_type.getElementsByTagName("li")

                    let last_li_element = li_elements[li_elements.length - 1]

                    if (last_li_element.innerHTML.includes("name=\"new_type_")) {
                        let id = parseInt(last_li_element.innerHTML.split("name=\"new_type_")[1].split("\"")[0]) + 1
                        let new_li_element = document.createElement("li")
                        new_li_element.innerHTML = "<input type='text' name='new_type_" + id + "'/>"
                        list_type.appendChild(new_li_element)
                        input.value = id
                    } else {
                        let new_li_element = document.createElement("li")
                        new_li_element.innerHTML = "<input type='text' name='new_type_0'/>"
                        list_type.appendChild(new_li_element)
                        input.value = 1
                    }
				}
            </script>

        </form>
    </div>
</div>

